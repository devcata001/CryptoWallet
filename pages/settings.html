<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ChainPilot - Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/style.css" />
</head>

<body class="dark-theme">
    <div class="mobile-topbar d-lg-none">
        <div class="brand"><i class="fa-solid fa-wallet"></i><span>ChainPilot</span></div>
        <div class="hamburger"><i class="fa fa-bars"></i></div>
    </div>
    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <a class="bottom-nav-link" href="../index.html">
            <i class="fa fa-chart-line"></i>
            <span>Overview</span>
        </a>
        <a class="bottom-nav-link" href="send.html">
            <i class="fa fa-paper-plane"></i>
            <span>Send</span>
        </a>
        <a class="bottom-nav-link" href="receive.html">
            <i class="fa fa-download"></i>
            <span>Receive</span>
        </a>
        <a class="bottom-nav-link" href="add.html">
            <i class="fa fa-plus"></i>
            <span>Add</span>
        </a>
        <a class="bottom-nav-link" href="transactions.html">
            <i class="fa fa-clock-rotate-left"></i>
            <span>Txs</span>
        </a>
        <a class="bottom-nav-link" href="settings.html">
            <i class="fa fa-gear"></i>
            <span>Settings</span>
        </a>
    </nav>
    <main class="main">
        <h1 class="mb-3">Settings</h1>
        <p class="text-secondary">Manage your account, security, and preferences.</p>
        <div class="form-card mb-4 slide-in-left" style="animation-delay: 0.2s;">
            <h5 class="mb-2">Account</h5>
            <div class="d-flex flex-wrap gap-4">
                <div><small class="text-secondary">Username</small>
                    <div id="profileUsername" class="fw-bold">--</div>
                </div>
                <div><small class="text-secondary">Session Started</small>
                    <div id="profileSessionTs" class="fw-bold">--</div>
                </div>
            </div>
        </div>
        <div class="form-card mb-4 slide-in-left" style="animation-delay: 0.3s;">
            <h5 class="mb-2">Holdings Summary</h5>
            <table class="table table-dark table-sm">
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="profileHoldings"></tbody>
            </table>
        </div>
        <div class="form-card mb-4 slide-in-left" style="animation-delay: 0.4s;">
            <h5 class="mb-2">Change Password</h5>
            <form id="pwdChangeForm" class="row g-3">
                <div class="col-12"><label class="form-label">Current Password</label><input type="password"
                        class="form-control" name="current" required /></div>
                <div class="col-12"><label class="form-label">New Password</label><input type="password"
                        class="form-control" name="new" required /></div>
                <div class="col-12"><label class="form-label">Confirm New Password</label><input type="password"
                        class="form-control" name="confirm" required /></div>
                <div class="col-12"><button class="btn btn-primary mt-2" type="submit"><i class="fa fa-key"></i>
                        Change Password</button></div>
            </form>
        </div>
        <div class="form-card mb-4 slide-in-left" style="animation-delay: 0.5s;">
            <h5>Password Strength</h5><input type="password" id="pwd" class="form-control"
                placeholder="Enter a password" />
            <div id="passwordStrength" class="mt-2">
                <div class="bar"></div>
            </div><small class="text-secondary">Increase length and mix characters for a stronger score.</small>
            <hr class="border-secondary my-4" />
            <h5>Two-Factor Authentication (Demo)</h5>
            <p class="text-secondary">Simulated toggle; doesn't send codes.</p>
            <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="twofaSwitch"><label
                    class="form-check-label" for="twofaSwitch">Enable 2FA</label></div><small id="twofaStatus"
                class="text-secondary mt-2 d-block">2FA disabled</small>
        </div>
        <div class="d-flex justify-content-center mt-4 mb-5">
            <button id="logoutBtn" class="btn btn-danger btn-lg px-5"><i
                    class="fa fa-right-from-bracket me-2"></i>Logout</button>
        </div>
    </main>
    <script src="../js/prices.js"></script>
    <script src="../js/script.js"></script>
    <script>
        // Profile info and holdings summary
        document.addEventListener('DOMContentLoaded', () => {
            // Username and session
            const session = JSON.parse(localStorage.getItem('nv_session') || 'null');
            document.getElementById('profileUsername').textContent = session ? session.username : '--';
            document.getElementById('profileSessionTs').textContent = session ? new Date(session.ts).toLocaleString() : '--';
            // Holdings summary
            const key = session ? ('nv_holdings_' + session.username) : 'nw_holdings';
            const holdings = JSON.parse(localStorage.getItem(key) || 'null') || { BTC: 0, ETH: 0, SOL: 0 };
            const tbody = document.getElementById('profileHoldings');
            tbody.innerHTML = '';
            Object.entries(holdings).forEach(([asset, amount]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${asset}</td><td>${amount}</td>`;
                tbody.appendChild(tr);
            });
            // Password strength and 2FA
            const sw = document.getElementById('twofaSwitch');
            const status = document.getElementById('twofaStatus');
            const saved = localStorage.getItem('nw_2fa') === 'true';
            sw.checked = saved;
            status.textContent = saved ? '2FA enabled' : '2FA disabled';
            sw.addEventListener('change', () => {
                localStorage.setItem('nw_2fa', sw.checked);
                status.textContent = sw.checked ? '2FA enabled' : '2FA disabled';
            });
        });
    </script>
</body>

</html>